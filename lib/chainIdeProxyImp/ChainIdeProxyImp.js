!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ChainIdeProxyImp=t():e.ChainIdeProxyImp=t()}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var i,r;n.r(t),function(e){e.plugin="plugin",e.ide="ide"}(i||(i={})),function(e){e.subscribeEvent="subscribeEvent",e.publishEvent="publishEvent",e.unsubscribeEvent="unsubscribeEvent",e.registerApiFunction="registerApiFunction",e.registerApiFunctionReturn="registerApiFunctionReturn",e.callApiFunction="callApiFunction"}(r||(r={}));var o=function(){return(o=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},u=function(e){var t=o({source:i.plugin,success:!0,top:window.top===window},e);window.top.postMessage(t,"*")};var a=function(){return(a=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},c=function(){function e(e){this.pluginOptions=e,this.events=[],this.registerApiFunctions=[],window.addEventListener("message",function(e){var t=e.data,n=this.pluginOptions.pluginId;if(t.source===i.ide)try{switch(t.actionType){case r.subscribeEvent:if(t.pluginId!==n)return;(o=this.getSubscribeCallbackByEventname(t.eventName))&&o(t);break;case r.registerApiFunctionReturn:if(t.targetPluginId!==n)return;var o,a=(o=this.getRegisterApiFunctionByEventname(t.functionName))(t.data);if(a&&a.then){a.then(function(e){u({actionType:r.registerApiFunctionReturn,currentPluginId:t.currentPluginId,targetPluginId:t.targetPluginId,functionName:t.functionName,data:e})}).catch(function(e){throw e});break}u({actionType:r.registerApiFunctionReturn,currentPluginId:t.currentPluginId,targetPluginId:t.targetPluginId,functionName:t.functionName,data:a});break;case r.callApiFunction:}}catch(e){console.error(e),u({pluginId:t.pluginId,eventName:t.eventName,functionName:t.functionName,success:!1,error:e})}}.bind(this),!1)}return e.prototype.getSubscribeCallbackByEventname=function(e){var t=this.events.filter(function(t){return t.eventName===e});return t.length>0&&t[0].callback},e.prototype.getRegisterApiFunctionByEventname=function(e){var t=this.registerApiFunctions.filter(function(t){return t.functionName===e});return t.length>0&&t[0].callback},e.prototype.subscribeEvent=function(e,t){var n=this.pluginOptions.pluginId;u({actionType:r.subscribeEvent,pluginId:n,eventName:e}),this.events.push({eventName:e,callback:t})},e.prototype.publishEvent=function(e,t){u({actionType:r.publishEvent,eventName:e,data:t})},e.prototype.unsubscribeEvent=function(e){var t=this,n=this.pluginOptions.pluginId;u({actionType:r.unsubscribeEvent,pluginId:n,eventName:e}),this.events.forEach(function(n,i){n.eventName===e&&(window.removeEventListener("message",n.callback.bind(t),!1),t.events.splice(i,1))})},e.prototype.registerApiFunction=function(e,t){var n=this.pluginOptions.pluginId;u({actionType:r.registerApiFunction,pluginId:n,functionName:e}),this.registerApiFunctions.push({functionName:e,callback:t})},e.prototype.fileSystemService=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o=this.pluginOptions.pluginId;return u({actionType:r.callApiFunction,currentPluginId:o,targetPluginId:"root",functionName:"fileSystem",data:{apiName:e,rest:t}}),new Promise(function(t,n){window.addEventListener("message",function u(c){c.data.source===i.ide&&c.data.actionType===r.callApiFunction&&"fileSystem"===c.data.functionName&&c.data.pluginId===o&&c.data.data.apiName===e&&(window.removeEventListener("message",u),c.data.success?t(a(a({},c.data),{data:c.data.data.res})):n(c.data.error))},!1)})},e.prototype.callApiFunction=function(e,t,n){var o=this.pluginOptions.pluginId;return u({actionType:r.callApiFunction,currentPluginId:o,targetPluginId:e,functionName:t,data:n}),new Promise(function(e,n){window.addEventListener("message",function u(a){a.data.source===i.ide&&a.data.actionType===r.callApiFunction&&a.data.functionName===t&&a.data.pluginId===o&&(window.removeEventListener("message",u),a.data.success?e(a.data):n(a.data.error))},!1)})},e}();t.default=c}]).default});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaGFpbklkZVByb3h5SW1wL3dlYnBhY2svdW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbiIsIndlYnBhY2s6Ly9DaGFpbklkZVByb3h5SW1wL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0NoYWluSWRlUHJveHlJbXAvLi9zcmMvdHlwZS50cyIsIndlYnBhY2s6Ly9DaGFpbklkZVByb3h5SW1wLy4vc3JjL3V0aWxzLnRzIiwid2VicGFjazovL0NoYWluSWRlUHJveHlJbXAvLi9zcmMvQ2hhaW5JZGVQcm94eUltcC50cyIsIndlYnBhY2s6Ly9DaGFpbklkZVByb3h5SW1wLy4vc3JjL1BsdWdpbk1lc3NhZ2UudHMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwiZGVmaW5lIiwiYW1kIiwid2luZG93IiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIlBsdWdpblNvdXJjZSIsIlBsdWdpblJlY2VpdmVNZXNzYWdlQWN0aW9uIiwic2VuZE1lc3NhZ2UiLCJvcHRpb24iLCJtc2ciLCJfX2Fzc2lnbiIsInNvdXJjZSIsInBsdWdpbiIsInN1Y2Nlc3MiLCJ0b3AiLCJwb3N0TWVzc2FnZSIsIkNoYWluSWRlUHJveHlJbXBfQ2hhaW5JZGVQcm94eUltcCIsIkNoYWluSWRlUHJveHlJbXAiLCJwbHVnaW5PcHRpb25zIiwidGhpcyIsImV2ZW50cyIsInJlZ2lzdGVyQXBpRnVuY3Rpb25zIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJkYXRhIiwicGx1Z2luSWQiLCJpZGUiLCJhY3Rpb25UeXBlIiwic3Vic2NyaWJlRXZlbnQiLCJjYWxsYmFjayIsImdldFN1YnNjcmliZUNhbGxiYWNrQnlFdmVudG5hbWUiLCJldmVudE5hbWUiLCJyZWdpc3RlckFwaUZ1bmN0aW9uUmV0dXJuIiwidGFyZ2V0UGx1Z2luSWQiLCJyZXNvbHZlQ2FsbGJhY2siLCJnZXRSZWdpc3RlckFwaUZ1bmN0aW9uQnlFdmVudG5hbWUiLCJmdW5jdGlvbk5hbWUiLCJ0aGVuIiwicmVzIiwiY3VycmVudFBsdWdpbklkIiwiY2F0Y2giLCJlcnJvciIsImNhbGxBcGlGdW5jdGlvbiIsImNvbnNvbGUiLCJldmVudG5hbWUiLCJldmVudEl0ZW0iLCJmaWx0ZXIiLCJpdGVtIiwibGVuZ3RoIiwiZnVuY3Rpb25JdGVtIiwiY2IiLCJwdXNoIiwicHVibGlzaEV2ZW50IiwidW5zdWJzY3JpYmVFdmVudCIsIl90aGlzIiwiZm9yRWFjaCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJzcGxpY2UiLCJyZWdpc3RlckFwaUZ1bmN0aW9uIiwiZmlsZVN5c3RlbVNlcnZpY2UiLCJhcGlOYW1lIiwicmVzdCIsIl9pIiwiYXJndW1lbnRzIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJoYW5kbGVNZXNzYWdlIiwiQ2hhaW5JZGVQcm94eUltcF9hc3NpZ24iXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsaUJBQUFDLFNBQUEsaUJBQUFDLE9BQ0FBLE9BQUFELFFBQUFELElBQ0EsbUJBQUFHLGVBQUFDLElBQ0FELFVBQUFILEdBQ0EsaUJBQUFDLFFBQ0FBLFFBQUEsaUJBQUFELElBRUFELEVBQUEsaUJBQUFDLElBUkEsQ0FTQ0ssT0FBQSxXQUNELG1CQ1RBLElBQUFDLEtBR0EsU0FBQUMsRUFBQUMsR0FHQSxHQUFBRixFQUFBRSxHQUNBLE9BQUFGLEVB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RyxhQUFlckIsRUFBMkJvQyxpQkFDekIsZUFBeEJuQixFQUFFQyxLQUFLWSxjQUNQYixFQUFFQyxLQUFLQyxXQUFhQSxHQUNwQkYsRUFBRUMsS0FBS0EsS0FBS29DLFVBQVlBLElBSTFCM0YsT0FBT3VGLG9CQUFvQixVQUFXVyxHQUVsQzVDLEVBQUVDLEtBQUtYLFFBRVRvRCxFQUFRRyxPQUNIN0MsRUFBRUMsT0FDTEEsS0FBTUQsRUFBRUMsS0FBS0EsS0FBS2MsT0FHcEI0QixFQUFPM0MsRUFBRUMsS0FBS2lCLFVBSWdDLE1BSXREeEIsRUFBQWhCLFVBQUF5QyxnQkFBQSxTQUFtQlQsRUFBd0JHLEVBQXNCWixHQUN2RCxJQUFBQyxFQUFhTixLQUFLRCxjQUFhTyxTQVN2QyxPQVJBbEIsR0FDRW9CLFdBQVlyQixFQUEyQm9DLGdCQUN2Q0gsZ0JBQWlCZCxFQUNqQlEsZUFBY0EsRUFDZEcsYUFBWUEsRUFDWlosS0FBSUEsSUFHQyxJQUFJd0MsUUFBUSxTQUFDQyxFQUFTQyxHQW9CM0JqRyxPQUFPcUQsaUJBQWlCLFVBbkJ4QixTQUFTNkMsRUFBYzVDLEdBRW5CQSxFQUFFQyxLQUFLYixTQUFXTixFQUFhcUIsS0FDL0JILEVBQUVDLEtBQUtHLGFBQWVyQixFQUEyQm9DLGlCQUNqRG5CLEVBQUVDLEtBQUtZLGVBQWlCQSxHQUN4QmIsRUFBRUMsS0FBS0MsV0FBYUEsSUFJdEJ4RCxPQUFPdUYsb0JBQW9CLFVBQVdXLEdBRWxDNUMsRUFBRUMsS0FBS1gsUUFFVG9ELEVBQVExQyxFQUFFQyxNQUVWMEMsRUFBTzNDLEVBQUVDLEtBQUtpQixVQUlnQyxNQUd4RHhCLEVBNUtBIiwiZmlsZSI6Ii4vQ2hhaW5JZGVQcm94eUltcC5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiB3ZWJwYWNrVW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbihyb290LCBmYWN0b3J5KSB7XG5cdGlmKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jylcblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0ZWxzZSBpZih0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpXG5cdFx0ZGVmaW5lKFtdLCBmYWN0b3J5KTtcblx0ZWxzZSBpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcpXG5cdFx0ZXhwb3J0c1tcIkNoYWluSWRlUHJveHlJbXBcIl0gPSBmYWN0b3J5KCk7XG5cdGVsc2Vcblx0XHRyb290W1wiQ2hhaW5JZGVQcm94eUltcFwiXSA9IGZhY3RvcnkoKTtcbn0pKHdpbmRvdywgZnVuY3Rpb24oKSB7XG5yZXR1cm4gIiwiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7IGVudW1lcmFibGU6IHRydWUsIGdldDogZ2V0dGVyIH0pO1xuIFx0XHR9XG4gXHR9O1xuXG4gXHQvLyBkZWZpbmUgX19lc01vZHVsZSBvbiBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIgPSBmdW5jdGlvbihleHBvcnRzKSB7XG4gXHRcdGlmKHR5cGVvZiBTeW1ib2wgIT09ICd1bmRlZmluZWQnICYmIFN5bWJvbC50b1N0cmluZ1RhZykge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBTeW1ib2wudG9TdHJpbmdUYWcsIHsgdmFsdWU6ICdNb2R1bGUnIH0pO1xuIFx0XHR9XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsgdmFsdWU6IHRydWUgfSk7XG4gXHR9O1xuXG4gXHQvLyBjcmVhdGUgYSBmYWtlIG5hbWVzcGFjZSBvYmplY3RcbiBcdC8vIG1vZGUgJiAxOiB2YWx1ZSBpcyBhIG1vZHVsZSBpZCwgcmVxdWlyZSBpdFxuIFx0Ly8gbW9kZSAmIDI6IG1lcmdlIGFsbCBwcm9wZXJ0aWVzIG9mIHZhbHVlIGludG8gdGhlIG5zXG4gXHQvLyBtb2RlICYgNDogcmV0dXJuIHZhbHVlIHdoZW4gYWxyZWFkeSBucyBvYmplY3RcbiBcdC8vIG1vZGUgJiA4fDE6IGJlaGF2ZSBsaWtlIHJlcXVpcmVcbiBcdF9fd2VicGFja19yZXF1aXJlX18udCA9IGZ1bmN0aW9uKHZhbHVlLCBtb2RlKSB7XG4gXHRcdGlmKG1vZGUgJiAxKSB2YWx1ZSA9IF9fd2VicGFja19yZXF1aXJlX18odmFsdWUpO1xuIFx0XHRpZihtb2RlICYgOCkgcmV0dXJuIHZhbHVlO1xuIFx0XHRpZigobW9kZSAmIDQpICYmIHR5cGVvZiB2YWx1ZSA9PT0gJ29iamVjdCcgJiYgdmFsdWUgJiYgdmFsdWUuX19lc01vZHVsZSkgcmV0dXJuIHZhbHVlO1xuIFx0XHR2YXIgbnMgPSBPYmplY3QuY3JlYXRlKG51bGwpO1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLnIobnMpO1xuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkobnMsICdkZWZhdWx0JywgeyBlbnVtZXJhYmxlOiB0cnVlLCB2YWx1ZTogdmFsdWUgfSk7XG4gXHRcdGlmKG1vZGUgJiAyICYmIHR5cGVvZiB2YWx1ZSAhPSAnc3RyaW5nJykgZm9yKHZhciBrZXkgaW4gdmFsdWUpIF9fd2VicGFja19yZXF1aXJlX18uZChucywga2V5LCBmdW5jdGlvbihrZXkpIHsgcmV0dXJuIHZhbHVlW2tleV07IH0uYmluZChudWxsLCBrZXkpKTtcbiBcdFx0cmV0dXJuIG5zO1xuIFx0fTtcblxuIFx0Ly8gZ2V0RGVmYXVsdEV4cG9ydCBmdW5jdGlvbiBmb3IgY29tcGF0aWJpbGl0eSB3aXRoIG5vbi1oYXJtb255IG1vZHVsZXNcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubiA9IGZ1bmN0aW9uKG1vZHVsZSkge1xuIFx0XHR2YXIgZ2V0dGVyID0gbW9kdWxlICYmIG1vZHVsZS5fX2VzTW9kdWxlID9cbiBcdFx0XHRmdW5jdGlvbiBnZXREZWZhdWx0KCkgeyByZXR1cm4gbW9kdWxlWydkZWZhdWx0J107IH0gOlxuIFx0XHRcdGZ1bmN0aW9uIGdldE1vZHVsZUV4cG9ydHMoKSB7IHJldHVybiBtb2R1bGU7IH07XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18uZChnZXR0ZXIsICdhJywgZ2V0dGVyKTtcbiBcdFx0cmV0dXJuIGdldHRlcjtcbiBcdH07XG5cbiBcdC8vIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbFxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5vID0gZnVuY3Rpb24ob2JqZWN0LCBwcm9wZXJ0eSkgeyByZXR1cm4gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iamVjdCwgcHJvcGVydHkpOyB9O1xuXG4gXHQvLyBfX3dlYnBhY2tfcHVibGljX3BhdGhfX1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5wID0gXCJcIjtcblxuXG4gXHQvLyBMb2FkIGVudHJ5IG1vZHVsZSBhbmQgcmV0dXJuIGV4cG9ydHNcbiBcdHJldHVybiBfX3dlYnBhY2tfcmVxdWlyZV9fKF9fd2VicGFja19yZXF1aXJlX18ucyA9IDApO1xuIiwiZXhwb3J0IGludGVyZmFjZSBQbHVnaW5PcHRpb25zIHtcbiAgcGx1Z2luSWQ6IHN0cmluZztcbn1cblxuZXhwb3J0IGVudW0gUGx1Z2luU291cmNlIHtcbiAgcGx1Z2luID0gJ3BsdWdpbicsXG4gIGlkZSA9ICdpZGUnXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQmFzZU1lc3NhZ2Uge1xuICBzdWNjZXNzOiBib29sZWFuO1xuICBzb3VyY2U6IFBsdWdpblNvdXJjZTtcbn1cblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby10eXBlLWFsaWFzXG5leHBvcnQgdHlwZSBTZW5kTWVzc2FnZSA9IEJhc2VNZXNzYWdlO1xuXG4vLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXR5cGUtYWxpYXNcbmV4cG9ydCB0eXBlIFJlY2VpdmVNZXNzYWdlID0gQmFzZU1lc3NhZ2U7XG5cbmV4cG9ydCBlbnVtIFBsdWdpblJlY2VpdmVNZXNzYWdlQWN0aW9uIHtcbiAgc3Vic2NyaWJlRXZlbnQgPSAnc3Vic2NyaWJlRXZlbnQnLFxuICBwdWJsaXNoRXZlbnQgPSAncHVibGlzaEV2ZW50JyxcbiAgdW5zdWJzY3JpYmVFdmVudCA9ICd1bnN1YnNjcmliZUV2ZW50JyxcbiAgcmVnaXN0ZXJBcGlGdW5jdGlvbiA9ICdyZWdpc3RlckFwaUZ1bmN0aW9uJyxcbiAgcmVnaXN0ZXJBcGlGdW5jdGlvblJldHVybiA9ICdyZWdpc3RlckFwaUZ1bmN0aW9uUmV0dXJuJyxcbiAgY2FsbEFwaUZ1bmN0aW9uID0gJ2NhbGxBcGlGdW5jdGlvbidcbn1cblxuZXhwb3J0IGludGVyZmFjZSBNZXNzYWdlRXZlbnQ8VCA9IGFueT4gZXh0ZW5kcyBFdmVudCB7XG4gIHJlYWRvbmx5IGRhdGE6IFQ7XG4gIHJlYWRvbmx5IG9yaWdpbjogc3RyaW5nO1xuICByZWFkb25seSBwb3J0czogYW55O1xuICByZWFkb25seSBzb3VyY2U6IFdpbmRvdztcbiAgaW5pdE1lc3NhZ2VFdmVudChcbiAgICB0eXBlQXJnOiBzdHJpbmcsXG4gICAgY2FuQnViYmxlQXJnOiBib29sZWFuLFxuICAgIGNhbmNlbGFibGVBcmc6IGJvb2xlYW4sXG4gICAgZGF0YUFyZzogVCxcbiAgICBvcmlnaW5Bcmc6IHN0cmluZyxcbiAgICBsYXN0RXZlbnRJZEFyZzogc3RyaW5nLFxuICAgIHNvdXJjZUFyZzogV2luZG93XG4gICk6IHZvaWQ7XG59XG4iLCJpbXBvcnQgeyBTZW5kTWVzc2FnZSwgUGx1Z2luU291cmNlIH0gZnJvbSAnLi90eXBlJztcblxuZXhwb3J0IGNvbnN0IHNlbmRNZXNzYWdlID0gPFQ+KG9wdGlvbjogVCkgPT4ge1xuICBjb25zdCBtc2c6IFNlbmRNZXNzYWdlID0ge1xuICAgIHNvdXJjZTogUGx1Z2luU291cmNlLnBsdWdpbixcbiAgICBzdWNjZXNzOiB0cnVlLFxuICAgIHRvcDogd2luZG93LnRvcCA9PT0gd2luZG93LFxuICAgIC4uLm9wdGlvblxuICB9O1xuXG4gIHdpbmRvdy50b3AucG9zdE1lc3NhZ2UobXNnLCAnKicpO1xufTtcbiIsImltcG9ydCB7IGhhbmRsZVJlY2VpdmVNZXNzYWdlIH0gZnJvbSAnLi9QbHVnaW5NZXNzYWdlJztcbmltcG9ydCB7IHNlbmRNZXNzYWdlIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQge1xuICBQbHVnaW5PcHRpb25zLFxuICBQbHVnaW5SZWNlaXZlTWVzc2FnZUFjdGlvbixcbiAgUGx1Z2luU291cmNlLFxuICBNZXNzYWdlRXZlbnRcbn0gZnJvbSAnLi90eXBlJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ2hhaW5JZGVQcm94eUltcCB7XG4gIHBsdWdpbk9wdGlvbnM6IFBsdWdpbk9wdGlvbnM7XG4gIGV2ZW50czogQXJyYXk8e1xuICAgIGV2ZW50TmFtZTogc3RyaW5nO1xuICAgIGNhbGxiYWNrOiBGdW5jdGlvbjtcbiAgfT47XG5cbiAgcmVnaXN0ZXJBcGlGdW5jdGlvbnM6IEFycmF5PHtcbiAgICBmdW5jdGlvbk5hbWU6IHN0cmluZztcbiAgICBjYWxsYmFjazogRnVuY3Rpb247XG4gIH0+O1xuXG4gIGNvbnN0cnVjdG9yKHBsdWdpbk9wdGlvbnM6IFBsdWdpbk9wdGlvbnMpIHtcbiAgICB0aGlzLnBsdWdpbk9wdGlvbnMgPSBwbHVnaW5PcHRpb25zO1xuICAgIHRoaXMuZXZlbnRzID0gW107XG4gICAgdGhpcy5yZWdpc3RlckFwaUZ1bmN0aW9ucyA9IFtdO1xuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBoYW5kbGVSZWNlaXZlTWVzc2FnZS5iaW5kKHRoaXMpLCBmYWxzZSk7XG4gIH1cblxuICBnZXRTdWJzY3JpYmVDYWxsYmFja0J5RXZlbnRuYW1lKGV2ZW50bmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3QgZXZlbnRJdGVtID0gdGhpcy5ldmVudHMuZmlsdGVyKFxuICAgICAgKGl0ZW0pID0+IGl0ZW0uZXZlbnROYW1lID09PSBldmVudG5hbWVcbiAgICApO1xuXG4gICAgaWYgKGV2ZW50SXRlbS5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gZXZlbnRJdGVtWzBdLmNhbGxiYWNrO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGdldFJlZ2lzdGVyQXBpRnVuY3Rpb25CeUV2ZW50bmFtZShmdW5jdGlvbk5hbWU6IHN0cmluZykge1xuICAgIGNvbnN0IGZ1bmN0aW9uSXRlbSA9IHRoaXMucmVnaXN0ZXJBcGlGdW5jdGlvbnMuZmlsdGVyKFxuICAgICAgKGl0ZW0pID0+IGl0ZW0uZnVuY3Rpb25OYW1lID09PSBmdW5jdGlvbk5hbWVcbiAgICApO1xuXG4gICAgaWYgKGZ1bmN0aW9uSXRlbS5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb25JdGVtWzBdLmNhbGxiYWNrO1xuICAgIH1cblxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHN1YnNjcmliZUV2ZW50KGV2ZW50TmFtZTogc3RyaW5nLCBjYjogRnVuY3Rpb24pIHtcbiAgICBjb25zdCB7IHBsdWdpbklkIH0gPSB0aGlzLnBsdWdpbk9wdGlvbnM7XG4gICAgc2VuZE1lc3NhZ2Uoe1xuICAgICAgYWN0aW9uVHlwZTogUGx1Z2luUmVjZWl2ZU1lc3NhZ2VBY3Rpb24uc3Vic2NyaWJlRXZlbnQsXG4gICAgICBwbHVnaW5JZCxcbiAgICAgIGV2ZW50TmFtZVxuICAgIH0pO1xuXG4gICAgdGhpcy5ldmVudHMucHVzaCh7XG4gICAgICBldmVudE5hbWUsXG4gICAgICBjYWxsYmFjazogY2JcbiAgICB9KTtcbiAgfVxuXG4gIHB1Ymxpc2hFdmVudDxUPihldmVudE5hbWU6IHN0cmluZywgZGF0YTogVCkge1xuICAgIHNlbmRNZXNzYWdlKHtcbiAgICAgIGFjdGlvblR5cGU6IFBsdWdpblJlY2VpdmVNZXNzYWdlQWN0aW9uLnB1Ymxpc2hFdmVudCxcbiAgICAgIGV2ZW50TmFtZSxcbiAgICAgIGRhdGFcbiAgICB9KTtcbiAgfVxuXG4gIHVuc3Vic2NyaWJlRXZlbnQoZXZlbnROYW1lOiBzdHJpbmcpIHtcbiAgICBjb25zdCB7IHBsdWdpbklkIH0gPSB0aGlzLnBsdWdpbk9wdGlvbnM7XG5cbiAgICBzZW5kTWVzc2FnZSh7XG4gICAgICBhY3Rpb25UeXBlOiBQbHVnaW5SZWNlaXZlTWVzc2FnZUFjdGlvbi51bnN1YnNjcmliZUV2ZW50LFxuICAgICAgcGx1Z2luSWQsXG4gICAgICBldmVudE5hbWVcbiAgICB9KTtcblxuICAgIHRoaXMuZXZlbnRzLmZvckVhY2goKGl0ZW0sIGkpID0+IHtcbiAgICAgIGlmIChpdGVtLmV2ZW50TmFtZSA9PT0gZXZlbnROYW1lKSB7XG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgaXRlbS5jYWxsYmFjay5iaW5kKHRoaXMpLCBmYWxzZSk7XG4gICAgICAgIHRoaXMuZXZlbnRzLnNwbGljZShpLCAxKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHJlZ2lzdGVyQXBpRnVuY3Rpb24oZnVuY3Rpb25OYW1lOiBzdHJpbmcsIGNiOiAoZGF0YT86IGFueSkgPT4gYW55KSB7XG4gICAgY29uc3QgeyBwbHVnaW5JZCB9ID0gdGhpcy5wbHVnaW5PcHRpb25zO1xuXG4gICAgc2VuZE1lc3NhZ2Uoe1xuICAgICAgYWN0aW9uVHlwZTogUGx1Z2luUmVjZWl2ZU1lc3NhZ2VBY3Rpb24ucmVnaXN0ZXJBcGlGdW5jdGlvbixcbiAgICAgIHBsdWdpbklkLFxuICAgICAgZnVuY3Rpb25OYW1lXG4gICAgfSk7XG5cbiAgICB0aGlzLnJlZ2lzdGVyQXBpRnVuY3Rpb25zLnB1c2goe1xuICAgICAgZnVuY3Rpb25OYW1lLFxuICAgICAgY2FsbGJhY2s6IGNiXG4gICAgfSk7XG4gIH1cblxuICBmaWxlU3lzdGVtU2VydmljZTxUPihhcGlOYW1lOiBzdHJpbmcsIC4uLnJlc3Q6IFRbXSkge1xuICAgIGNvbnN0IHsgcGx1Z2luSWQgfSA9IHRoaXMucGx1Z2luT3B0aW9ucztcbiAgICBzZW5kTWVzc2FnZSh7XG4gICAgICBhY3Rpb25UeXBlOiBQbHVnaW5SZWNlaXZlTWVzc2FnZUFjdGlvbi5jYWxsQXBpRnVuY3Rpb24sXG4gICAgICBjdXJyZW50UGx1Z2luSWQ6IHBsdWdpbklkLFxuICAgICAgdGFyZ2V0UGx1Z2luSWQ6ICdyb290JyxcbiAgICAgIGZ1bmN0aW9uTmFtZTogJ2ZpbGVTeXN0ZW0nLFxuICAgICAgZGF0YToge1xuICAgICAgICBhcGlOYW1lLFxuICAgICAgICByZXN0XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgZnVuY3Rpb24gaGFuZGxlTWVzc2FnZShlOiBNZXNzYWdlRXZlbnQ8YW55Pikge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgZS5kYXRhLnNvdXJjZSAhPT0gUGx1Z2luU291cmNlLmlkZSB8fFxuICAgICAgICAgIGUuZGF0YS5hY3Rpb25UeXBlICE9PSBQbHVnaW5SZWNlaXZlTWVzc2FnZUFjdGlvbi5jYWxsQXBpRnVuY3Rpb24gfHxcbiAgICAgICAgICBlLmRhdGEuZnVuY3Rpb25OYW1lICE9PSAnZmlsZVN5c3RlbScgfHxcbiAgICAgICAgICBlLmRhdGEucGx1Z2luSWQgIT09IHBsdWdpbklkIHx8XG4gICAgICAgICAgZS5kYXRhLmRhdGEuYXBpTmFtZSAhPT0gYXBpTmFtZVxuICAgICAgICApXG4gICAgICAgICAgcmV0dXJuO1xuXG4gICAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgaGFuZGxlTWVzc2FnZSk7XG5cbiAgICAgICAgaWYgKGUuZGF0YS5zdWNjZXNzKSB7XG4gICAgICAgICAgLy8gVE9ETzpuZW1vIHRpbWVvdXRcbiAgICAgICAgICByZXNvbHZlKHtcbiAgICAgICAgICAgIC4uLmUuZGF0YSxcbiAgICAgICAgICAgIGRhdGE6IGUuZGF0YS5kYXRhLnJlc1xuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlamVjdChlLmRhdGEuZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgaGFuZGxlTWVzc2FnZSwgZmFsc2UpO1xuICAgIH0pO1xuICB9XG5cbiAgY2FsbEFwaUZ1bmN0aW9uPFQ+KHRhcmdldFBsdWdpbklkOiBzdHJpbmcsIGZ1bmN0aW9uTmFtZTogc3RyaW5nLCBkYXRhOiBUKSB7XG4gICAgY29uc3QgeyBwbHVnaW5JZCB9ID0gdGhpcy5wbHVnaW5PcHRpb25zO1xuICAgIHNlbmRNZXNzYWdlKHtcbiAgICAgIGFjdGlvblR5cGU6IFBsdWdpblJlY2VpdmVNZXNzYWdlQWN0aW9uLmNhbGxBcGlGdW5jdGlvbixcbiAgICAgIGN1cnJlbnRQbHVnaW5JZDogcGx1Z2luSWQsXG4gICAgICB0YXJnZXRQbHVnaW5JZCxcbiAgICAgIGZ1bmN0aW9uTmFtZSxcbiAgICAgIGRhdGFcbiAgICB9KTtcblxuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBmdW5jdGlvbiBoYW5kbGVNZXNzYWdlKGU6IE1lc3NhZ2VFdmVudDxhbnk+KSB7XG4gICAgICAgIGlmIChcbiAgICAgICAgICBlLmRhdGEuc291cmNlICE9PSBQbHVnaW5Tb3VyY2UuaWRlIHx8XG4gICAgICAgICAgZS5kYXRhLmFjdGlvblR5cGUgIT09IFBsdWdpblJlY2VpdmVNZXNzYWdlQWN0aW9uLmNhbGxBcGlGdW5jdGlvbiB8fFxuICAgICAgICAgIGUuZGF0YS5mdW5jdGlvbk5hbWUgIT09IGZ1bmN0aW9uTmFtZSB8fFxuICAgICAgICAgIGUuZGF0YS5wbHVnaW5JZCAhPT0gcGx1Z2luSWRcbiAgICAgICAgKVxuICAgICAgICAgIHJldHVybjtcblxuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGhhbmRsZU1lc3NhZ2UpO1xuXG4gICAgICAgIGlmIChlLmRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgIC8vIFRPRE86bmVtbyB0aW1lb3V0XG4gICAgICAgICAgcmVzb2x2ZShlLmRhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlamVjdChlLmRhdGEuZXJyb3IpO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgaGFuZGxlTWVzc2FnZSwgZmFsc2UpO1xuICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQgeyBQbHVnaW5SZWNlaXZlTWVzc2FnZUFjdGlvbiwgUGx1Z2luU291cmNlLCBNZXNzYWdlRXZlbnQgfSBmcm9tICcuL3R5cGUnO1xuaW1wb3J0IHsgc2VuZE1lc3NhZ2UgfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCBDaGFpbklkZVByb3h5SW1wIGZyb20gJy4vQ2hhaW5JZGVQcm94eUltcC5kJztcblxuZXhwb3J0IGZ1bmN0aW9uIGhhbmRsZVJlY2VpdmVNZXNzYWdlKGU6IE1lc3NhZ2VFdmVudDxhbnk+KSB7XG4gIGNvbnN0IF90ID0gdGhpcyBhcyBDaGFpbklkZVByb3h5SW1wO1xuICBjb25zdCB7IGRhdGEgfSA9IGU7XG4gIGNvbnN0IHsgcGx1Z2luSWQgfSA9IHRoaXMucGx1Z2luT3B0aW9ucztcbiAgaWYgKGRhdGEuc291cmNlID09PSBQbHVnaW5Tb3VyY2UuaWRlKSB7XG4gICAgdHJ5IHtcbiAgICAgIHN3aXRjaCAoZGF0YS5hY3Rpb25UeXBlKSB7XG4gICAgICAgIGNhc2UgUGx1Z2luUmVjZWl2ZU1lc3NhZ2VBY3Rpb24uc3Vic2NyaWJlRXZlbnQ6XG4gICAgICAgICAge1xuICAgICAgICAgICAgaWYgKGRhdGEucGx1Z2luSWQgIT09IHBsdWdpbklkKSByZXR1cm47XG5cbiAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrID0gX3QuZ2V0U3Vic2NyaWJlQ2FsbGJhY2tCeUV2ZW50bmFtZShkYXRhLmV2ZW50TmFtZSk7XG4gICAgICAgICAgICBjYWxsYmFjayAmJiBjYWxsYmFjayhkYXRhKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgUGx1Z2luUmVjZWl2ZU1lc3NhZ2VBY3Rpb24ucmVnaXN0ZXJBcGlGdW5jdGlvblJldHVybjpcbiAgICAgICAgICB7XG4gICAgICAgICAgICBpZiAoZGF0YS50YXJnZXRQbHVnaW5JZCAhPT0gcGx1Z2luSWQpIHJldHVybjtcblxuICAgICAgICAgICAgY29uc3QgY2FsbGJhY2sgPSBfdC5nZXRSZWdpc3RlckFwaUZ1bmN0aW9uQnlFdmVudG5hbWUoXG4gICAgICAgICAgICAgIGRhdGEuZnVuY3Rpb25OYW1lXG4gICAgICAgICAgICApIGFzIGFueTtcblxuICAgICAgICAgICAgY29uc3QgcmVzb2x2ZUNhbGxiYWNrID0gY2FsbGJhY2soZGF0YS5kYXRhKTtcblxuICAgICAgICAgICAgaWYgKHJlc29sdmVDYWxsYmFjayAmJiByZXNvbHZlQ2FsbGJhY2sudGhlbikge1xuICAgICAgICAgICAgICAocmVzb2x2ZUNhbGxiYWNrIGFzIFByb21pc2U8YW55PilcbiAgICAgICAgICAgICAgICAudGhlbigocmVzOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgIHNlbmRNZXNzYWdlKHtcbiAgICAgICAgICAgICAgICAgICAgYWN0aW9uVHlwZTpcbiAgICAgICAgICAgICAgICAgICAgICBQbHVnaW5SZWNlaXZlTWVzc2FnZUFjdGlvbi5yZWdpc3RlckFwaUZ1bmN0aW9uUmV0dXJuLFxuICAgICAgICAgICAgICAgICAgICBjdXJyZW50UGx1Z2luSWQ6IGRhdGEuY3VycmVudFBsdWdpbklkLFxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRQbHVnaW5JZDogZGF0YS50YXJnZXRQbHVnaW5JZCxcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb25OYW1lOiBkYXRhLmZ1bmN0aW9uTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogcmVzXG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5jYXRjaCgoZXJyb3I6IGFueSkgPT4ge1xuICAgICAgICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHNlbmRNZXNzYWdlKHtcbiAgICAgICAgICAgICAgYWN0aW9uVHlwZTogUGx1Z2luUmVjZWl2ZU1lc3NhZ2VBY3Rpb24ucmVnaXN0ZXJBcGlGdW5jdGlvblJldHVybixcbiAgICAgICAgICAgICAgY3VycmVudFBsdWdpbklkOiBkYXRhLmN1cnJlbnRQbHVnaW5JZCxcbiAgICAgICAgICAgICAgdGFyZ2V0UGx1Z2luSWQ6IGRhdGEudGFyZ2V0UGx1Z2luSWQsXG4gICAgICAgICAgICAgIGZ1bmN0aW9uTmFtZTogZGF0YS5mdW5jdGlvbk5hbWUsXG4gICAgICAgICAgICAgIGRhdGE6IHJlc29sdmVDYWxsYmFja1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFBsdWdpblJlY2VpdmVNZXNzYWdlQWN0aW9uLmNhbGxBcGlGdW5jdGlvbjpcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG5cbiAgICAgIHNlbmRNZXNzYWdlKHtcbiAgICAgICAgcGx1Z2luSWQ6IGRhdGEucGx1Z2luSWQsXG4gICAgICAgIGV2ZW50TmFtZTogZGF0YS5ldmVudE5hbWUsXG4gICAgICAgIGZ1bmN0aW9uTmFtZTogZGF0YS5mdW5jdGlvbk5hbWUsXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvclxuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9