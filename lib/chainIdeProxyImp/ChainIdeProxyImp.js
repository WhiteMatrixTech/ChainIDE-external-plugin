!function(n,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ChainIdeProxyImp=e():n.ChainIdeProxyImp=e()}(window,function(){return function(n){var e={};function t(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return n[i].call(r.exports,r,r.exports,t),r.l=!0,r.exports}return t.m=n,t.c=e,t.d=function(n,e,i){t.o(n,e)||Object.defineProperty(n,e,{enumerable:!0,get:i})},t.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},t.t=function(n,e){if(1&e&&(n=t(n)),8&e)return n;if(4&e&&"object"==typeof n&&n&&n.__esModule)return n;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:n}),2&e&&"string"!=typeof n)for(var r in n)t.d(i,r,function(e){return n[e]}.bind(null,r));return i},t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,"a",e),e},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.p="",t(t.s=0)}([function(n,e,t){"use strict";var i,r;t.r(e),function(n){n.plugin="plugin",n.ide="ide"}(i||(i={})),function(n){n.subscribeEvent="subscribeEvent",n.publishEvent="publishEvent",n.unsubscribeEvent="unsubscribeEvent",n.registerApiFunction="registerApiFunction",n.registerApiFunctionReturn="registerApiFunctionReturn",n.callApiFunction="callApiFunction"}(r||(r={}));var u=function(){return(u=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}).apply(this,arguments)},o=function(n){var e=u({source:i.plugin,success:!0,top:window.top===window},n);window.top.postMessage(e,"*")};var c=function(){function n(n){this.pluginOptions=n,this.events=[],this.registerApiFunctions=[],window.addEventListener("message",function(n){var e=n.data,t=this.pluginOptions.pluginId;if(e.source===i.ide)try{switch(e.actionType){case r.subscribeEvent:if(e.pluginId!==t)return;(u=this.getSubscribeCallbackByEventname(e.eventName))&&u(e);break;case r.registerApiFunctionReturn:if(e.targetPluginId!==t)return;var u;if((u=this.getRegisterApiFunctionByEventname(e.functionName))&&"function"===u.then||u.toString().includes("Promise")){u(e.data).then(function(n){o({actionType:r.registerApiFunctionReturn,currentPluginId:e.currentPluginId,targetPluginId:e.targetPluginId,functionName:e.functionName,data:n})}).catch(function(n){throw n});break}o({actionType:r.registerApiFunctionReturn,currentPluginId:e.currentPluginId,targetPluginId:e.targetPluginId,functionName:e.functionName,data:u&&u(e.data)});break;case r.callApiFunction:}}catch(n){console.error(n),o({pluginId:e.pluginId,eventName:e.eventName,functionName:e.functionName,success:!1,error:n})}}.bind(this),!1)}return n.prototype.getSubscribeCallbackByEventname=function(n){var e=this.events.filter(function(e){return e.eventName===n});return e.length>0&&e[0].callback},n.prototype.getRegisterApiFunctionByEventname=function(n){var e=this.registerApiFunctions.filter(function(e){return e.functionName===n});return e.length>0&&e[0].callback},n.prototype.subscribeEvent=function(n,e){var t=this.pluginOptions.pluginId;o({actionType:r.subscribeEvent,pluginId:t,eventName:n}),this.events.push({eventName:n,callback:e})},n.prototype.publishEvent=function(n,e){o({actionType:r.publishEvent,eventName:n,data:e})},n.prototype.unsubscribeEvent=function(n){var e=this,t=this.pluginOptions.pluginId;o({actionType:r.unsubscribeEvent,pluginId:t,eventName:n}),this.events.forEach(function(t,i){t.eventName===n&&(window.removeEventListener("message",t.callback.bind(e),!1),e.events.splice(i,1))})},n.prototype.registerApiFunction=function(n,e){var t=this.pluginOptions.pluginId;o({actionType:r.registerApiFunction,pluginId:t,functionName:n}),this.registerApiFunctions.push({functionName:n,callback:e})},n.prototype.callApiFunction=function(n,e,t){var u=this.pluginOptions.pluginId;return o({actionType:r.callApiFunction,currentPluginId:u,targetPluginId:n,functionName:e,data:t}),new Promise(function(n,t){window.addEventListener("message",function o(c){c.data.source===i.ide&&c.data.actionType===r.callApiFunction&&c.data.functionName===e&&c.data.pluginId===u&&(window.removeEventListener("message",o),c.data.success?n(c.data):t(c.data.error))},!1)})},n}();e.default=c}]).default});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaGFpbklkZVByb3h5SW1wL3dlYnBhY2svdW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbiIsIndlYnBhY2s6Ly9DaGFpbklkZVByb3h5SW1wL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0NoYWluSWRlUHJveHlJbXAvLi9zcmMvdHlwZS50cyIsIndlYnBhY2s6Ly9DaGFpbklkZVByb3h5SW1wLy4vc3JjL3V0aWxzLnRzIiwid2VicGFjazovL0NoYWluSWRlUHJveHlJbXAvLi9zcmMvQ2hhaW5JZGVQcm94eUltcC50cyIsIndlYnBhY2s6Ly9DaGFpbklkZVByb3h5SW1wLy4vc3JjL1BsdWdpbk1lc3NhZ2UudHMiXSwibmFtZXMiOlsicm9vdCIsImZhY3RvcnkiLCJleHBvcnRzIiwibW9kdWxlIiwiZGVmaW5lIiwiYW1kIiwid2luZG93IiwiaW5zdGFsbGVkTW9kdWxlcyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsIlBsdWdpblNvdXJjZSIsIlBsdWdpblJlY2VpdmVNZXNzYWdlQWN0aW9uIiwic2VuZE1lc3NhZ2UiLCJvcHRpb24iLCJtc2ciLCJfX2Fzc2lnbiIsInNvdXJjZSIsInBsdWdpbiIsInN1Y2Nlc3MiLCJ0b3AiLCJwb3N0TWVzc2FnZSIsIkNoYWluSWRlUHJveHlJbXBfQ2hhaW5JZGVQcm94eUltcCIsIkNoYWluSWRlUHJveHlJbXAiLCJwbHVnaW5PcHRpb25zIiwidGhpcyIsImV2ZW50cyIsInJlZ2lzdGVyQXBpRnVuY3Rpb25zIiwiYWRkRXZlbnRMaXN0ZW5lciIsImUiLCJkYXRhIiwicGx1Z2luSWQiLCJpZGUiLCJhY3Rpb25UeXBlIiwic3Vic2NyaWJlRXZlbnQiLCJjYWxsYmFjayIsImdldFN1YnNjcmliZUNhbGxiYWNrQnlFdmVudG5hbWUiLCJldmVudE5hbWUiLCJyZWdpc3RlckFwaUZ1bmN0aW9uUmV0dXJuIiwidGFyZ2V0UGx1Z2luSWQiLCJnZXRSZWdpc3RlckFwaUZ1bmN0aW9uQnlFdmVudG5hbWUiLCJmdW5jdGlvbk5hbWUiLCJ0aGVuIiwidG9TdHJpbmciLCJpbmNsdWRlcyIsInJlcyIsImN1cnJlbnRQbHVnaW5JZCIsImNhdGNoIiwiZXJyb3IiLCJjYWxsQXBpRnVuY3Rpb24iLCJjb25zb2xlIiwiZXZlbnRuYW1lIiwiZXZlbnRJdGVtIiwiZmlsdGVyIiwiaXRlbSIsImxlbmd0aCIsImZ1bmN0aW9uSXRlbSIsImNiIiwicHVzaCIsInB1Ymxpc2hFdmVudCIsInVuc3Vic2NyaWJlRXZlbnQiLCJfdGhpcyIsImZvckVhY2giLCJyZW1vdmVFdmVudExpc3RlbmVyIiwic3BsaWNlIiwicmVnaXN0ZXJBcGlGdW5jdGlvbiIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiaGFuZGxlTWVzc2FnZSJdLCJtYXBwaW5ncyI6IkNBQUEsU0FBQUEsRUFBQUMsR0FDQSxpQkFBQUMsU0FBQSxpQkFBQUMsT0FDQUEsT0FBQUQsUUFBQUQsSUFDQSxtQkFBQUcsZUFBQUMsSUFDQUQsVUFBQUgsR0FDQSxpQkFBQUMsUUFDQUEsUUFBQSxpQkFBQUQsSUFFQUQsRUFBQSxpQkFBQUMsSUFSQSxDQVNDSyxPQUFBLFdBQ0QsbUJDVEEsSUFBQUMsS0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQVAsUUFHQSxJQUFBQyxFQUFBSSxFQUFBRSxJQUNBQyxFQUFBRCxFQUNBRSxHQUFBLEVBQ0FULFlBVUEsT0FOQVUsRUFB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LEtBQUtYLFFBRVRnRCxFQUFRdEMsRUFBRUMsTUFFVnNDLEVBQU92QyxFQUFFQyxLQUFLa0IsVUFJZ0MsTUFHeER6QixFQW5JQSIsImZpbGUiOiIuL0NoYWluSWRlUHJveHlJbXAuanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJDaGFpbklkZVByb3h5SW1wXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcIkNoYWluSWRlUHJveHlJbXBcIl0gPSBmYWN0b3J5KCk7XG59KSh3aW5kb3csIGZ1bmN0aW9uKCkge1xucmV0dXJuICIsIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAwKTtcbiIsImV4cG9ydCBpbnRlcmZhY2UgUGx1Z2luT3B0aW9ucyB7XG4gIHBsdWdpbklkOiBzdHJpbmc7XG59XG5cbmV4cG9ydCBlbnVtIFBsdWdpblNvdXJjZSB7XG4gIHBsdWdpbiA9ICdwbHVnaW4nLFxuICBpZGUgPSAnaWRlJ1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJhc2VNZXNzYWdlIHtcbiAgc3VjY2VzczogYm9vbGVhbjtcbiAgc291cmNlOiBQbHVnaW5Tb3VyY2U7XG59XG5cbi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdHlwZS1hbGlhc1xuZXhwb3J0IHR5cGUgU2VuZE1lc3NhZ2UgPSBCYXNlTWVzc2FnZTtcblxuLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby10eXBlLWFsaWFzXG5leHBvcnQgdHlwZSBSZWNlaXZlTWVzc2FnZSA9IEJhc2VNZXNzYWdlO1xuXG5leHBvcnQgZW51bSBQbHVnaW5SZWNlaXZlTWVzc2FnZUFjdGlvbiB7XG4gIHN1YnNjcmliZUV2ZW50ID0gJ3N1YnNjcmliZUV2ZW50JyxcbiAgcHVibGlzaEV2ZW50ID0gJ3B1Ymxpc2hFdmVudCcsXG4gIHVuc3Vic2NyaWJlRXZlbnQgPSAndW5zdWJzY3JpYmVFdmVudCcsXG4gIHJlZ2lzdGVyQXBpRnVuY3Rpb24gPSAncmVnaXN0ZXJBcGlGdW5jdGlvbicsXG4gIHJlZ2lzdGVyQXBpRnVuY3Rpb25SZXR1cm4gPSAncmVnaXN0ZXJBcGlGdW5jdGlvblJldHVybicsXG4gIGNhbGxBcGlGdW5jdGlvbiA9ICdjYWxsQXBpRnVuY3Rpb24nXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgTWVzc2FnZUV2ZW50PFQgPSBhbnk+IGV4dGVuZHMgRXZlbnQge1xuICByZWFkb25seSBkYXRhOiBUO1xuICByZWFkb25seSBvcmlnaW46IHN0cmluZztcbiAgcmVhZG9ubHkgcG9ydHM6IGFueTtcbiAgcmVhZG9ubHkgc291cmNlOiBXaW5kb3c7XG4gIGluaXRNZXNzYWdlRXZlbnQoXG4gICAgdHlwZUFyZzogc3RyaW5nLFxuICAgIGNhbkJ1YmJsZUFyZzogYm9vbGVhbixcbiAgICBjYW5jZWxhYmxlQXJnOiBib29sZWFuLFxuICAgIGRhdGFBcmc6IFQsXG4gICAgb3JpZ2luQXJnOiBzdHJpbmcsXG4gICAgbGFzdEV2ZW50SWRBcmc6IHN0cmluZyxcbiAgICBzb3VyY2VBcmc6IFdpbmRvd1xuICApOiB2b2lkO1xufVxuIiwiaW1wb3J0IHsgU2VuZE1lc3NhZ2UsIFBsdWdpblNvdXJjZSB9IGZyb20gJy4vdHlwZSc7XG5cbmV4cG9ydCBjb25zdCBzZW5kTWVzc2FnZSA9IDxUPihvcHRpb246IFQpID0+IHtcbiAgY29uc3QgbXNnOiBTZW5kTWVzc2FnZSA9IHtcbiAgICBzb3VyY2U6IFBsdWdpblNvdXJjZS5wbHVnaW4sXG4gICAgc3VjY2VzczogdHJ1ZSxcbiAgICB0b3A6IHdpbmRvdy50b3AgPT09IHdpbmRvdyxcbiAgICAuLi5vcHRpb25cbiAgfTtcblxuICB3aW5kb3cudG9wLnBvc3RNZXNzYWdlKG1zZywgJyonKTtcbn07XG4iLCJpbXBvcnQgeyBoYW5kbGVSZWNlaXZlTWVzc2FnZSB9IGZyb20gJy4vUGx1Z2luTWVzc2FnZSc7XG5pbXBvcnQgeyBzZW5kTWVzc2FnZSB9IGZyb20gJy4vdXRpbHMnO1xuaW1wb3J0IHtcbiAgUGx1Z2luT3B0aW9ucyxcbiAgUGx1Z2luUmVjZWl2ZU1lc3NhZ2VBY3Rpb24sXG4gIFBsdWdpblNvdXJjZSxcbiAgTWVzc2FnZUV2ZW50XG59IGZyb20gJy4vdHlwZSc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENoYWluSWRlUHJveHlJbXAge1xuICBwbHVnaW5PcHRpb25zOiBQbHVnaW5PcHRpb25zO1xuICBldmVudHM6IEFycmF5PHtcbiAgICBldmVudE5hbWU6IHN0cmluZztcbiAgICBjYWxsYmFjazogRnVuY3Rpb247XG4gIH0+O1xuXG4gIHJlZ2lzdGVyQXBpRnVuY3Rpb25zOiBBcnJheTx7XG4gICAgZnVuY3Rpb25OYW1lOiBzdHJpbmc7XG4gICAgY2FsbGJhY2s6IEZ1bmN0aW9uO1xuICB9PjtcblxuICBjb25zdHJ1Y3RvcihwbHVnaW5PcHRpb25zOiBQbHVnaW5PcHRpb25zKSB7XG4gICAgdGhpcy5wbHVnaW5PcHRpb25zID0gcGx1Z2luT3B0aW9ucztcbiAgICB0aGlzLmV2ZW50cyA9IFtdO1xuICAgIHRoaXMucmVnaXN0ZXJBcGlGdW5jdGlvbnMgPSBbXTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgaGFuZGxlUmVjZWl2ZU1lc3NhZ2UuYmluZCh0aGlzKSwgZmFsc2UpO1xuICB9XG5cbiAgZ2V0U3Vic2NyaWJlQ2FsbGJhY2tCeUV2ZW50bmFtZShldmVudG5hbWU6IHN0cmluZykge1xuICAgIGNvbnN0IGV2ZW50SXRlbSA9IHRoaXMuZXZlbnRzLmZpbHRlcihcbiAgICAgIChpdGVtKSA9PiBpdGVtLmV2ZW50TmFtZSA9PT0gZXZlbnRuYW1lXG4gICAgKTtcblxuICAgIGlmIChldmVudEl0ZW0ubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIGV2ZW50SXRlbVswXS5jYWxsYmFjaztcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBnZXRSZWdpc3RlckFwaUZ1bmN0aW9uQnlFdmVudG5hbWUoZnVuY3Rpb25OYW1lOiBzdHJpbmcpIHtcbiAgICBjb25zdCBmdW5jdGlvbkl0ZW0gPSB0aGlzLnJlZ2lzdGVyQXBpRnVuY3Rpb25zLmZpbHRlcihcbiAgICAgIChpdGVtKSA9PiBpdGVtLmZ1bmN0aW9uTmFtZSA9PT0gZnVuY3Rpb25OYW1lXG4gICAgKTtcblxuICAgIGlmIChmdW5jdGlvbkl0ZW0ubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uSXRlbVswXS5jYWxsYmFjaztcbiAgICB9XG5cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBzdWJzY3JpYmVFdmVudChldmVudE5hbWU6IHN0cmluZywgY2I6IEZ1bmN0aW9uKSB7XG4gICAgY29uc3QgeyBwbHVnaW5JZCB9ID0gdGhpcy5wbHVnaW5PcHRpb25zO1xuICAgIHNlbmRNZXNzYWdlKHtcbiAgICAgIGFjdGlvblR5cGU6IFBsdWdpblJlY2VpdmVNZXNzYWdlQWN0aW9uLnN1YnNjcmliZUV2ZW50LFxuICAgICAgcGx1Z2luSWQsXG4gICAgICBldmVudE5hbWVcbiAgICB9KTtcblxuICAgIHRoaXMuZXZlbnRzLnB1c2goe1xuICAgICAgZXZlbnROYW1lLFxuICAgICAgY2FsbGJhY2s6IGNiXG4gICAgfSk7XG4gIH1cblxuICBwdWJsaXNoRXZlbnQ8VD4oZXZlbnROYW1lOiBzdHJpbmcsIGRhdGE6IFQpIHtcbiAgICBzZW5kTWVzc2FnZSh7XG4gICAgICBhY3Rpb25UeXBlOiBQbHVnaW5SZWNlaXZlTWVzc2FnZUFjdGlvbi5wdWJsaXNoRXZlbnQsXG4gICAgICBldmVudE5hbWUsXG4gICAgICBkYXRhXG4gICAgfSk7XG4gIH1cblxuICB1bnN1YnNjcmliZUV2ZW50KGV2ZW50TmFtZTogc3RyaW5nKSB7XG4gICAgY29uc3QgeyBwbHVnaW5JZCB9ID0gdGhpcy5wbHVnaW5PcHRpb25zO1xuXG4gICAgc2VuZE1lc3NhZ2Uoe1xuICAgICAgYWN0aW9uVHlwZTogUGx1Z2luUmVjZWl2ZU1lc3NhZ2VBY3Rpb24udW5zdWJzY3JpYmVFdmVudCxcbiAgICAgIHBsdWdpbklkLFxuICAgICAgZXZlbnROYW1lXG4gICAgfSk7XG5cbiAgICB0aGlzLmV2ZW50cy5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XG4gICAgICBpZiAoaXRlbS5ldmVudE5hbWUgPT09IGV2ZW50TmFtZSkge1xuICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGl0ZW0uY2FsbGJhY2suYmluZCh0aGlzKSwgZmFsc2UpO1xuICAgICAgICB0aGlzLmV2ZW50cy5zcGxpY2UoaSwgMSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICByZWdpc3RlckFwaUZ1bmN0aW9uKGZ1bmN0aW9uTmFtZTogc3RyaW5nLCBjYjogKGRhdGE/OiBhbnkpID0+IGFueSkge1xuICAgIGNvbnN0IHsgcGx1Z2luSWQgfSA9IHRoaXMucGx1Z2luT3B0aW9ucztcblxuICAgIHNlbmRNZXNzYWdlKHtcbiAgICAgIGFjdGlvblR5cGU6IFBsdWdpblJlY2VpdmVNZXNzYWdlQWN0aW9uLnJlZ2lzdGVyQXBpRnVuY3Rpb24sXG4gICAgICBwbHVnaW5JZCxcbiAgICAgIGZ1bmN0aW9uTmFtZVxuICAgIH0pO1xuXG4gICAgdGhpcy5yZWdpc3RlckFwaUZ1bmN0aW9ucy5wdXNoKHtcbiAgICAgIGZ1bmN0aW9uTmFtZSxcbiAgICAgIGNhbGxiYWNrOiBjYlxuICAgIH0pO1xuICB9XG5cbiAgY2FsbEFwaUZ1bmN0aW9uPFQ+KHRhcmdldFBsdWdpbklkOiBzdHJpbmcsIGZ1bmN0aW9uTmFtZTogc3RyaW5nLCBkYXRhOiBUKSB7XG4gICAgY29uc3QgeyBwbHVnaW5JZCB9ID0gdGhpcy5wbHVnaW5PcHRpb25zO1xuICAgIHNlbmRNZXNzYWdlKHtcbiAgICAgIGFjdGlvblR5cGU6IFBsdWdpblJlY2VpdmVNZXNzYWdlQWN0aW9uLmNhbGxBcGlGdW5jdGlvbixcbiAgICAgIGN1cnJlbnRQbHVnaW5JZDogcGx1Z2luSWQsXG4gICAgICB0YXJnZXRQbHVnaW5JZDogdGFyZ2V0UGx1Z2luSWQsXG4gICAgICBmdW5jdGlvbk5hbWUsXG4gICAgICBkYXRhXG4gICAgfSk7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgZnVuY3Rpb24gaGFuZGxlTWVzc2FnZShlOiBNZXNzYWdlRXZlbnQ8YW55Pikge1xuICAgICAgICBpZiAoXG4gICAgICAgICAgZS5kYXRhLnNvdXJjZSAhPT0gUGx1Z2luU291cmNlLmlkZSB8fFxuICAgICAgICAgIGUuZGF0YS5hY3Rpb25UeXBlICE9PSBQbHVnaW5SZWNlaXZlTWVzc2FnZUFjdGlvbi5jYWxsQXBpRnVuY3Rpb24gfHxcbiAgICAgICAgICBlLmRhdGEuZnVuY3Rpb25OYW1lICE9PSBmdW5jdGlvbk5hbWUgfHxcbiAgICAgICAgICBlLmRhdGEucGx1Z2luSWQgIT09IHBsdWdpbklkXG4gICAgICAgIClcbiAgICAgICAgICByZXR1cm47XG5cbiAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBoYW5kbGVNZXNzYWdlKTtcblxuICAgICAgICBpZiAoZS5kYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAvLyBUT0RPOm5lbW8gdGltZW91dFxuICAgICAgICAgIHJlc29sdmUoZS5kYXRhKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZWplY3QoZS5kYXRhLmVycm9yKTtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGhhbmRsZU1lc3NhZ2UsIGZhbHNlKTtcbiAgICB9KTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgUGx1Z2luUmVjZWl2ZU1lc3NhZ2VBY3Rpb24sIFBsdWdpblNvdXJjZSwgTWVzc2FnZUV2ZW50IH0gZnJvbSAnLi90eXBlJztcbmltcG9ydCB7IHNlbmRNZXNzYWdlIH0gZnJvbSAnLi91dGlscyc7XG5pbXBvcnQgQ2hhaW5JZGVQcm94eUltcCBmcm9tICcuL0NoYWluSWRlUHJveHlJbXAuZCc7XG5cbmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVSZWNlaXZlTWVzc2FnZShlOiBNZXNzYWdlRXZlbnQ8YW55Pikge1xuICBjb25zdCBfdCA9IHRoaXMgYXMgQ2hhaW5JZGVQcm94eUltcDtcbiAgY29uc3QgeyBkYXRhIH0gPSBlO1xuICBjb25zdCB7IHBsdWdpbklkIH0gPSB0aGlzLnBsdWdpbk9wdGlvbnM7XG4gIGlmIChkYXRhLnNvdXJjZSA9PT0gUGx1Z2luU291cmNlLmlkZSkge1xuICAgIHRyeSB7XG4gICAgICBzd2l0Y2ggKGRhdGEuYWN0aW9uVHlwZSkge1xuICAgICAgICBjYXNlIFBsdWdpblJlY2VpdmVNZXNzYWdlQWN0aW9uLnN1YnNjcmliZUV2ZW50OlxuICAgICAgICAgIHtcbiAgICAgICAgICAgIGlmIChkYXRhLnBsdWdpbklkICE9PSBwbHVnaW5JZCkgcmV0dXJuO1xuXG4gICAgICAgICAgICBjb25zdCBjYWxsYmFjayA9IF90LmdldFN1YnNjcmliZUNhbGxiYWNrQnlFdmVudG5hbWUoZGF0YS5ldmVudE5hbWUpO1xuICAgICAgICAgICAgY2FsbGJhY2sgJiYgY2FsbGJhY2soZGF0YSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFBsdWdpblJlY2VpdmVNZXNzYWdlQWN0aW9uLnJlZ2lzdGVyQXBpRnVuY3Rpb25SZXR1cm46XG4gICAgICAgICAge1xuICAgICAgICAgICAgaWYgKGRhdGEudGFyZ2V0UGx1Z2luSWQgIT09IHBsdWdpbklkKSByZXR1cm47XG5cbiAgICAgICAgICAgIGNvbnN0IGNhbGxiYWNrID0gX3QuZ2V0UmVnaXN0ZXJBcGlGdW5jdGlvbkJ5RXZlbnRuYW1lKFxuICAgICAgICAgICAgICBkYXRhLmZ1bmN0aW9uTmFtZVxuICAgICAgICAgICAgKSBhcyBhbnk7XG5cbiAgICAgICAgICAgIGlmIChcbiAgICAgICAgICAgICAgKCEhY2FsbGJhY2sgJiYgY2FsbGJhY2sudGhlbiA9PT0gJ2Z1bmN0aW9uJykgfHxcbiAgICAgICAgICAgICAgY2FsbGJhY2sudG9TdHJpbmcoKS5pbmNsdWRlcygnUHJvbWlzZScpXG4gICAgICAgICAgICApIHtcbiAgICAgICAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby11bnNhZmUtY2FsbFxuICAgICAgICAgICAgICBjYWxsYmFjayhkYXRhLmRhdGEpXG4gICAgICAgICAgICAgICAgLnRoZW4oKHJlczogYW55KSA9PiB7XG4gICAgICAgICAgICAgICAgICBzZW5kTWVzc2FnZSh7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvblR5cGU6XG4gICAgICAgICAgICAgICAgICAgICAgUGx1Z2luUmVjZWl2ZU1lc3NhZ2VBY3Rpb24ucmVnaXN0ZXJBcGlGdW5jdGlvblJldHVybixcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFBsdWdpbklkOiBkYXRhLmN1cnJlbnRQbHVnaW5JZCxcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0UGx1Z2luSWQ6IGRhdGEudGFyZ2V0UGx1Z2luSWQsXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uTmFtZTogZGF0YS5mdW5jdGlvbk5hbWUsXG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc1xuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goKGVycm9yOiBhbnkpID0+IHtcbiAgICAgICAgICAgICAgICAgIHRocm93IGVycm9yO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgc2VuZE1lc3NhZ2Uoe1xuICAgICAgICAgICAgICBhY3Rpb25UeXBlOiBQbHVnaW5SZWNlaXZlTWVzc2FnZUFjdGlvbi5yZWdpc3RlckFwaUZ1bmN0aW9uUmV0dXJuLFxuICAgICAgICAgICAgICBjdXJyZW50UGx1Z2luSWQ6IGRhdGEuY3VycmVudFBsdWdpbklkLFxuICAgICAgICAgICAgICB0YXJnZXRQbHVnaW5JZDogZGF0YS50YXJnZXRQbHVnaW5JZCxcbiAgICAgICAgICAgICAgZnVuY3Rpb25OYW1lOiBkYXRhLmZ1bmN0aW9uTmFtZSxcbiAgICAgICAgICAgICAgZGF0YTogY2FsbGJhY2sgJiYgY2FsbGJhY2soZGF0YS5kYXRhKVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlIFBsdWdpblJlY2VpdmVNZXNzYWdlQWN0aW9uLmNhbGxBcGlGdW5jdGlvbjpcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XG5cbiAgICAgIHNlbmRNZXNzYWdlKHtcbiAgICAgICAgcGx1Z2luSWQ6IGRhdGEucGx1Z2luSWQsXG4gICAgICAgIGV2ZW50TmFtZTogZGF0YS5ldmVudE5hbWUsXG4gICAgICAgIGZ1bmN0aW9uTmFtZTogZGF0YS5mdW5jdGlvbk5hbWUsXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLFxuICAgICAgICBlcnJvclxuICAgICAgfSk7XG4gICAgfVxuICB9XG59XG4iXSwic291cmNlUm9vdCI6IiJ9